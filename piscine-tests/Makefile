# Piscine Go Makefile
# Makes running tests super easy!

.PHONY: test test-verbose coverage coverage-html bench clean help

# Default target
all: test

# Run all tests
test:
	@echo "ðŸ§ª Running tests..."
	@go test ./piscine -cover

# Run tests with verbose output
test-verbose:
	@echo "ðŸ§ª Running tests (verbose)..."
	@go test ./piscine -v -cover

# Run tests with coverage
coverage:
	@echo "ðŸ“Š Generating coverage report..."
	@go test ./piscine -coverprofile=coverage.out
	@go tool cover -func=coverage.out

# Generate HTML coverage report
coverage-html: coverage
	@echo "ðŸŒ Opening coverage in browser..."
	@go tool cover -html=coverage.out

# Run benchmarks
bench:
	@echo "ðŸŽï¸  Running benchmarks..."
	@go test ./piscine -bench=. -benchmem

# Run specific test (usage: make test-one TEST=TestGcd)
test-one:
	@echo "ðŸŽ¯ Running $(TEST)..."
	@go test ./piscine -v -run $(TEST)

# Clean generated files
clean:
	@echo "ðŸ§¹ Cleaning up..."
	@rm -f coverage.out
	@go clean

# Run tests and benchmarks
full: test bench

# Show test statistics
stats: coverage
	@echo ""
	@echo "ðŸ“ˆ Test Statistics:"
	@go test ./piscine -v 2>&1 | grep -E "PASS|FAIL" | wc -l | xargs -I {} echo "  Total tests: {}"
	@go test ./piscine -cover 2>&1 | grep coverage | cut -d':' -f2

# Watch mode - run tests on file changes (requires entr)
watch:
	@echo "ðŸ‘€ Watching for changes..."
	@find . -name "*.go" | entr -c make test

# Help menu
help:
	@echo "ðŸ“š Available commands:"
	@echo ""
	@echo "  make test          - Run all tests"
	@echo "  make test-verbose  - Run tests with verbose output"
	@echo "  make coverage      - Generate coverage report"
	@echo "  make coverage-html - Open coverage report in browser"
	@echo "  make bench         - Run benchmarks"
	@echo "  make test-one      - Run specific test (TEST=TestName)"
	@echo "  make clean         - Remove generated files"
	@echo "  make full          - Run tests and benchmarks"
	@echo "  make stats         - Show test statistics"
	@echo "  make watch         - Watch files and auto-test (needs entr)"
	@echo "  make help          - Show this help message"
	@echo ""
	@echo "Examples:"
	@echo "  make test-one TEST=TestGcd"
	@echo "  make coverage-html"